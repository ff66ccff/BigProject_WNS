# 稳态氢键筛选器 (Stable Hydrogen Bond Filter)

基于WnS (Wrap 'n' Shake) 算法的专门氢键筛选工具，用于识别蛋白质-配体复合物中的稳定氢键相互作用。

## 🎯 核心功能

本工具专注于筛选具有稳定氢键的配体，通过三阶段流程：

1. **Wrapper阶段**：在蛋白质表面生成多个配体构象
2. **Shaker阶段**：通过模拟退火(300K→323K→300K)测试氢键稳定性
3. **Analysis阶段**：统计氢键并筛选稳定相互作用

## 🔍 筛选标准

### 严格筛选条件
- **必须具有氢键**：没有氢键的配体直接被过滤掉
- **距离标准**：供体-受体距离 < 3.5Å
- **角度标准**：供体-氢-受体角度 > 120°
- **稳定性测试**：通过323K高温考验的氢键

### 评分系统
```
WnS Score = 相互作用能 (E_inter) - (氢键数量 × 2.0)
```

- **分数越低越好**
- 只输出有氢键的配体
- 能量再低但没有氢键的配体不会出现在结果中

## 🚀 使用方法

### 完整流程
```bash
python scripts/run_hbond_detector.py
```

### 单独分析
```bash
python scripts/analyze_hbonds.py complex.pdb -o results --csv
```

## 📊 输出结果

### CSV文件包含
- `ligand_id`: 配体残基ID
- `cluster_id`: 聚类ID
- `score`: WnS评分（越低越好）
- `e_inter`: 相互作用能
- `n_hbonds`: 氢键数量
- `hbond_details`: 氢键详细信息（供体/受体原子对）

### 关键特性
- **只输出有氢键的配体**
- **按评分排序**
- **包含详细的氢键信息**

## ⚙️ 配置参数

### 氢键判定参数
```bash
python scripts/analyze_hbonds.py complex.pdb -d 3.2 -a 130.0
```
- `-d`: 距离阈值（默认3.5Å）
- `-a`: 角度阈值（默认120°）

### 模拟退火参数
- 起始温度：300K
- 峰值温度：323K
- 结束温度：300K
- 位置限制：开启(-DPOSRES)

## 🎯 应用场景

1. **药物设计**：筛选具有稳定氢键的候选化合物
2. **结合机制研究**：识别关键的氢键相互作用
3. **虚拟筛选**：从大量化合物中筛选有意义的结合模式
4. **结构优化**：指导配体结构改进以增强氢键网络

## 🔬 工作原理

### Wrapper阶段
- 生成覆盖蛋白质表面的配体群
- 确保物理合理的初始构象
- 输出`wrapped_complex.pdb`

### Shaker阶段
- 模拟退火测试氢键稳定性
- 弱氢键在323K断裂，配体脱落
- 强氢键保留，配体稳定
- 清洗机制：删除位移>6.0Å的配体

### Analysis阶段
- 聚类分析：取聚类中心代表
- 氢键计数：严格距离和角度标准
- 评分计算：能量+氢键贡献
- 结果筛选：只保留有氢键的配体

## 📈 性能特点

- **高精度**：严格的氢键判定标准
- **稳定性测试**：通过高温验证
- **高效筛选**：自动过滤无氢键配体
- **详细分析**：提供完整的氢键信息

## 🎉 核心优势

1. **专注氢键**：只关注有意义的氢键相互作用
2. **稳定性验证**：通过物理仿真验证氢键强度
3. **自动化流程**：一键完成筛选和分析
4. **结果纯净**：输出只包含有氢键的配体

这个工具特别适合需要识别和筛选具有稳定氢键相互作用的场景，确保输出的每个配体都有明确的氢键锚定。